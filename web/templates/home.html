{{define "now"}}
    <div class="panel panel-primary">
      <div class="panel-heading">
	<h4 class="panel-title">
	  Now
	  <span class="glyphicon glyphicon-retweet pull-right" ng-click="nowThenFlip()"></span>
	</h4>
      </div>
      <ul id="messages" class="list-group">
	<li id="messageinputitem" class="list-group-item">
	  <form xclass="form-inline" ng-submit="sendMessage(message, 'input')" autocomplete="off">
	    <input id="iAm" class="form-control" type="text" typeahead="activity for activity in allMessages() | filter:$viewValue" ng-model="message" placeholder="message to Marvin">
	    <input type="hidden" ng-model="state.Activity">
	    <!--<button type="submit" class="btn">Add</button>-->
	  </form>
	</li>
      </ul>
    </div>

    <div class="panel panel-schedule">
      <div class="panel-heading">Schedule</div>
      <div class="panel-body">
	<p>11:00PM <span class="text-primary">Goodnight</span></p>
      </div>
    </div>
{{end}}

{{define "then"}}
    <div class="panel panel-default">
      <div class="panel-heading">
	<h4 class="panel-title">
	  Then <span class="glyphicon glyphicon-retweet pull-right" ng-click="nowThenFlip()"></span>
	</h4>
      </div>
      <ul class="list-group" ng-switch on="state.RecentMessages.Start > 0">
	<li ng-switch-when="true" class="list-group-item">... more ...</li>
	<li class="list-group-item message" ng-repeat="message in recentMessages(false)">
	  <div class="row">
	    <div class="col-lg-10">[[message.Who]]: <span class="what [[message.Why]]">[[message.What]]</span></div>
	    <div class="col-lg-2 text-right"><small>[[formatWhen(message.When)]]</small></div>
	  </div>
	</li>
      </ul>
    </div>
{{end}}

{{define "content"}}

  {{with .Marvin}}

<div ng-controller="MarvinCtrl">

  <div class="alert alert-info" ng-repeat="message in state.Messages">
    [[message]]
  </div>

  <div class="alert alert-error" ng-repeat="error in errors">
    [[error]]
  </div>

  <div class="alert alert-error" ng-repeat="error in state.Hue.Errors">
    [[error.Error.Description]]
  </div>

  <div class="col-xs-12 col-sm-8 col-md-8 col-lg-8">

    <div id="nowthen" class="flip-container" xontouchstart="this.classList.toggle('hover');">
      <div class="flipper">
	<div class="front">
	  {{template "now" .}}
	</div>
	<div class="back">
	  {{template "then" .}}
	</div>
      </div>
    </div>
    
  </div>

  <div class="col-xs-12 col-sm-4 col-md-4 col-lg-4">

    <div class="panel-group overflowvisible">

      <div class="panel panel-switches">
	<div class="panel-heading">
	  <h4 class="panel-title">
            <a data-toggle="collapse" data-target="#collapseSwitches">
	      Switches
            </a>
	  </h4>
	</div>
	<div id="collapseSwitches" class="panel-collapse collapse">
	  <div class="panel-body">
	    <form ng-submit="changeState()">
	      {{range $k, $v := .Switch}}
	      <label class="checkbox"><input type=checkbox ng-model="state.Switch['{{$k}}']" ng-change="changeState('{{$k}}', state.Switch['{{$k}}'])">{{$k}}</label>{{end}}
	    </form>
	  </div>
	</div>
      </div>

      <div class="panel panel-lightgroups">
	<div class="panel-heading">
	  <h4 class="panel-title">
            <a data-toggle="collapse" data-target="#collapseLightgroups">
	      Light Groups
            </a>
	  </h4>
	</div>
	<div id="collapseLightgroups" class="panel-collapse collapse">
	  <table class="table">
	    <thead>
	      <tr>
		<th>Name</th>
		<th><i class="icon-off"></i> State</th>
	      </tr>
	    </thead>
	    <tbody>
	      <tr ng-repeat="(name, group) in state.Hue.Datastore.groups">
		<td>[[group.name]]</td>
		<td>
		  <div ng-switch on="group.action.on" class="btn-group">
		    <button
		       ng-switch-when="true"
		       type="button" class="btn btn-default btn-lg"
		       style="color: black; background-color: [[getColor(group.action)]]"
		       ng-click="setHue('/groups/'+name+'/action', OFF, 'lightgroups')">On</button>
		    <button
		       ng-switch-when="false"
		       type="button" class="btn btn-default btn-lg"
		       ng-click="setHue('/groups/'+name+'/action', ON, 'lightgroups')">Off</button>
		    <button type="button" class="btn btn-default btn-lg dropdown-toggle" data-toggle="dropdown">
		      <span class="caret"></span>
		    </button>
		    <ul class="dropdown-menu" role="menu">
		      <li ng-repeat="choice in allStates()">
			<a class="btn btn-lg" ng-click="setHue('/groups/'+name+'/action', state.States[choice], 'lightgroups')"
			   style="color: black; background-color: [[getColor(state.States[choice])]]">[[choice]]</a>
		      </li>
		    </ul>
		  </div>
		</td>
	      </tr>
	    </tbody>
	  </table>
	</div>
      </div>

      <div class="panel panel-lightbulbs">
	<div class="panel-heading">
	  <h4 class="panel-title">
            <a data-toggle="collapse" data-target="#collapseLightbulbs">
	      Light Bulbs
            </a>
	  </h4>
	</div>

	<div id="collapseLightbulbs" class="panel-collapse collapse">
	  <table class="table table-condensed">
	    <thead>
	      <tr>
		<th>Name</th>
		<th><i class="icon-off"></i> State</th>
	      </tr>
	    </thead>
	    <tbody>
	      <tr ng-repeat="(name, light) in state.Hue.Datastore.lights">
		<td>[[light.name]]</td>
		<td>
		  <div ng-switch on="light.state.on" class="btn-group">
		    <button
		       ng-switch-when="true"
		       type="button" class="btn btn-default btn-lg"
		       style="color: black; background-color: [[getColor(light.state)]]"
		       ng-click="setHue('/lights/'+name+'/state', OFF, 'lightbulbs')">On</button>
		    <button
		       ng-switch-when="false"
		       type="button" class="btn btn-default btn-lg"
		       ng-click="setHue('/lights/'+name+'/state', ON, 'lightbulbs')">Off</button>
		    <button type="button" class="btn btn-default btn-lg dropdown-toggle" data-toggle="dropdown"
			    style="color: black; background-color: [[getColor(light.state)]]">
		      <span class="caret"></span>
		    </button>
		    <ul class="dropdown-menu" role="menu">
		      <li ng-repeat="choice in allStates()">
			<a class="btn btn-lg" ng-click="setHue('/lights/'+name+'/state', state.States[choice], 'lightbulbs')"
			   style="color: black; background-color: [[getColor(state.States[choice])]]">[[choice]]</a>
		      </li>
		    </ul>
		  </div>
		</td>
	      </tr>
	    </tbody>
	  </table>
	</div>
      </div>

      <div class="panel panel-presence">
	<div class="panel-heading">
	  <h4 class="panel-title">
            <a data-toggle="collapse" data-target="#collapsePresence">
	      Presence
            </a>
	  </h4>
	</div>
	<div id="collapsePresence" class="panel-collapse collapse">
	  {{template "presence" .}}
	</div>
      </div>

      <div class="panel panel-sensors">
	<div class="panel-heading">
	  <h4 class="panel-title">
            <a data-toggle="collapse" data-target="#collapseSensors">
	      Sensors
            </a>
	  </h4>
	</div>
	<div id="collapseSensors" class="panel-collapse collapse">
	  {{template "sensors" .}}
	</div>
      </div>
    </div>

  </div>

</div>

  {{end}}

{{end}}
